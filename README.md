# DS3231_MAX7219_Clock
**Многофункциональные Arduino-часы на LED матрице с контроллером MAX7219**

![DS3231_MAX7219_Clock](https://raw.githubusercontent.com/iw0rm3r/DS3231_MAX7219_Clock/master/photo.jpg)
[Демонстрационное видео](https://youtu.be/-j2KcqIpfdY)

Программная основа для сборки многофункциональных часов на базе **Arduino Uno/nano** с использованием модуля часов реального времени **DS3231** и LED матрицы из модулей на базе контроллера **MAX7219**. Для работы с LED матрицей используются собственные функции, составляющие «обёртку» вокруг легковесной библиотеки **Faster_LEDControl**, т.к. многоцелевые библиотеки управления LED матрицами, вроде MD_Parola, избыточны и не позволяют уместить нужный функционал во flash-память контроллера Arduino Uno. **Проект находится на стадии разработки**.

**Функционал, реализованный на данный момент:**
1.	Режим отображения текущего времени;
2.	Режим вывода текущей даты в виде бегущей строки;
3.	Режим отображения температуры воздуха на основе сопротивления терморезистора (низкая точность);
4.	Режим вывода данных, передаваемых по UART с ПК, в графическом виде. Запланирован для отображения визуализатора спектра воспроизводимой на ПК музыки (рассчитывается приложением на стороне ПК). В данный момент приложение на ПК не закончено, поэтому отображается только громкость в виде горизонтального столбца;
5.	Использование разных шрифтов для разных режимов работы;
6.	Автоматическая настройка яркости/выключение LED матрицы в зависимости от освещённости (используется фоторезистор);
7.	Реализован будильник по внешнему прерыванию от модуля DS3231 с визуальной (при помощи отдельного светодиода) и звуковой сигнализацией (при помощи пъезодинамика). Возможность настройки будильника с помощью LED матрицы пока не реализована, для тестирования используется долгое нажатие на единственную кнопку (устанавливает будильник на 10 сек вперёд);
8.	Тактовая кнопка используется для выключения будильника, либо для переключения между режимами работы.

**Используемые компоненты:**
1.	Отладочная плата Arduino Uno/nano;
2.	Модуль часов реального времени DS3231;
3.	LED матрица из произвольного числа модулей на контроллерах MAX7219;
4.	Макетная (печатная) плата;
5.	Фоторезистор c резистором на 10 кОм для настройки яркости матрицы; 
6.	Термистор c резистором на 10 кОм для определения температуры воздуха (низкая точность);
7.	Пъезодинамик для сигнализации будильника, сигнализации в случае ошибки работы и подзвучивания нажатий кнопок. Лучше подключать через потенциометр для настройки громкости звука;
8.	Отдельный светодиод, подключённый через резистор на 220 Ом, для сигнализации будильника и остановки работы (в случае проблемы с модулем часов);
9.	Тактовая кнопка.

**Как использовать?**
1.	Скачать исходники проекта с помощью `git clone https://github.com/iw0rm3r/DS3231_MAX7219_Clock.git`, либо с помощью кнопки *«Clone or download»* > *«Download ZIP»*;
2.	Собрать схему, подключив компоненты к пинам Arduino, указанным в основном .ino-файле проекта, либо указав свои пины;
3.	Скомпилировать и загрузить проект в контроллер с помощью Arduino IDE, либо другой связки ПО.

**Структура проекта:**
1.	*DS3231_MAX7219_Clock.ino* – основной файл проекта (используемые библиотеки, пины, настройки, глобальные переменные)
2.	*a_MAX7219_stuff.ino* – всё, что относится к выводу данных на LED матрицу
3.	*b_DS3231_stuff.ino* – все основные функции;
4.	*z_setup_loop.ino* – функции setup() и loop();
5.	*iwTimer.cpp* – класс таймера на основе функции millis() для реализации многозадачности;
6.	*5bite_rus_forum.h* и *7segment_fixed.h* – файлы шрифтов (источники указаны в комментариях).

**Планируемый функционал:**  
- [ ]	Визуализатор звукового спектра (отдельная программа на ПК);  
- [ ]	Стабилизация значений освещённости для устранения скачков яркости;  
- [ ]	Режим настройки часов через LED матрицу с помощью кнопок;  
- [ ]	Режим настройки будильника через LED матрицу с помощью кнопок;  
- [ ]	Возможность настройки времени и будильника через UART с ПК;  
- [ ]	Возможность отключения вывода отладочных сообщений по UART при компиляции;  
- [ ]	Возможность автоматического перехода к режиму часов по тайм-ауту.  
